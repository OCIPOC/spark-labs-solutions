<h1 id="solution-for-dataset">Solution for Dataset</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" data-line-number="1"></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">// This is used to implicitly convert an RDD to a DataFrame.</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">import</span> spark.<span class="fu">implicits</span>._</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">sql</span>._</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">sql</span>.<span class="fu">types</span>._</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">// == read DF using csv reader - no schema</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">val</span> peopleDF = spark.<span class="fu">read</span>.</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">               <span class="fu">option</span>(<span class="st">&quot;header&quot;</span>, <span class="st">&quot;true&quot;</span>).</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">               <span class="co">// option(&quot;inferSchema&quot;, &quot;true&quot;).</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">               <span class="fu">csv</span>(<span class="st">&quot;/data/people/people2.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">peopleDF.<span class="fu">columns</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">peopleDF.<span class="fu">printSchema</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">// == read DF using csv reader with schema</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="kw">val</span> nameField = <span class="fu">StructField</span>(<span class="st">&quot;name&quot;</span>, StringType)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="kw">val</span> genderField = <span class="fu">StructField</span>(<span class="st">&quot;gender&quot;</span>, StringType)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw">val</span> ageField = <span class="fu">StructField</span>(<span class="st">&quot;age&quot;</span>, IntegerType)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">val</span> weightField = <span class="fu">StructField</span>(<span class="st">&quot;weight&quot;</span>, FloatType)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw">val</span> peopleSchema = <span class="fu">StructType</span>(Array(nameField, genderField, ageField, weightField ))</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="kw">val</span> peopleDF2 = spark.<span class="fu">read</span>.<span class="fu">option</span>(<span class="st">&quot;header&quot;</span>, <span class="st">&quot;true&quot;</span>).</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">         <span class="fu">schema</span>(peopleSchema).</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">         <span class="fu">csv</span>(<span class="st">&quot;/data/people/people2.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">peopleDF2.<span class="fu">printSchema</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">// == reading RDD with custom schema and converting it to Dataset</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="kw">final</span> <span class="kw">case</span> <span class="kw">class</span> <span class="fu">Person</span> (</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    name: String,</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">    gender: String,</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    age:Integer,</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    weight:Float</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">  )</a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="kw">val</span> p = spark.<span class="fu">sparkContext</span>.<span class="fu">textFile</span>(<span class="st">&quot;/data/people/people.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="kw">val</span> peopleRDD = p.<span class="fu">map</span> (line =&gt; {</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">        <span class="kw">val</span> tokens = line.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">        <span class="kw">val</span> name = <span class="fu">tokens</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">        <span class="kw">val</span> gender = <span class="fu">tokens</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">        <span class="kw">val</span> age = <span class="fu">tokens</span>(<span class="dv">2</span>).<span class="fu">toInt</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">        <span class="kw">val</span> weight = <span class="fu">tokens</span>(<span class="dv">3</span>).<span class="fu">toFloat</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">        <span class="kw">new</span> <span class="fu">Person</span> (name, gender, age, weight)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">      })</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">peopleRDD.<span class="fu">collect</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-47" data-line-number="47"></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="co">// convert to Dataset</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="kw">val</span> peopleDS = peopleRDD.<span class="fu">toDS</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="co">// another approach</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="kw">val</span> peopleDS2 = spark.<span class="fu">createDataset</span>[Person](peopleRDD)</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">peopleDS.<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co">// access RDD from dataset</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55">peopleDS.<span class="fu">rdd</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">// perform operations in typed</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">peopleDS.<span class="fu">filter</span>(_.<span class="fu">age</span> &gt; <span class="dv">20</span>).<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59">    <span class="co">// +----+------+---+</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60">    <span class="co">// |name|gender|age|</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61">    <span class="co">// +----+------+---+</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62">    <span class="co">// |John|     M| 35|</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    <span class="co">// |Jane|     F| 40|</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">    <span class="co">// +----+------+---+</span></a>
<a class="sourceLine" id="cb1-65" data-line-number="65"></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"></a>
<a class="sourceLine" id="cb1-67" data-line-number="67"></a>
<a class="sourceLine" id="cb1-68" data-line-number="68">peopleDS.<span class="fu">map</span>( p =&gt; p.<span class="fu">name</span>.<span class="fu">toUpperCase</span>).<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-69" data-line-number="69">    <span class="co">// +-----+</span></a>
<a class="sourceLine" id="cb1-70" data-line-number="70">    <span class="co">// |value|</span></a>
<a class="sourceLine" id="cb1-71" data-line-number="71">    <span class="co">// +-----+</span></a>
<a class="sourceLine" id="cb1-72" data-line-number="72">    <span class="co">// | JOHN|</span></a>
<a class="sourceLine" id="cb1-73" data-line-number="73">    <span class="co">// | JANE|</span></a>
<a class="sourceLine" id="cb1-74" data-line-number="74">    <span class="co">// | MIKE|</span></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">    <span class="co">// |  SUE|</span></a>
<a class="sourceLine" id="cb1-76" data-line-number="76">    <span class="co">// +-----+</span></a>
<a class="sourceLine" id="cb1-77" data-line-number="77"></a>
<a class="sourceLine" id="cb1-78" data-line-number="78"></a>
<a class="sourceLine" id="cb1-79" data-line-number="79"><span class="co">// === convert Dataset to Dataframe</span></a>
<a class="sourceLine" id="cb1-80" data-line-number="80"><span class="kw">val</span> df2 = peopleDS.<span class="fu">toDF</span></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"><span class="co">// df2: org.apache.spark.sql.DataFrame = [name: string, gender: string ... 1 more field]</span></a>
<a class="sourceLine" id="cb1-82" data-line-number="82"></a>
<a class="sourceLine" id="cb1-83" data-line-number="83"><span class="co">// === convert Dataframe to Dataset</span></a>
<a class="sourceLine" id="cb1-84" data-line-number="84"><span class="kw">val</span> ds2 = df2.<span class="fu">as</span>[Person]</a>
<a class="sourceLine" id="cb1-85" data-line-number="85"><span class="co">// ds2: org.apache.spark.sql.Dataset[Person] = [name: string, gender: string ... 1 more field]</span></a>
<a class="sourceLine" id="cb1-86" data-line-number="86"></a>
<a class="sourceLine" id="cb1-87" data-line-number="87"><span class="co">// dataframe  &amp; RDD</span></a>
<a class="sourceLine" id="cb1-88" data-line-number="88">df2.<span class="fu">rdd</span></a>
<a class="sourceLine" id="cb1-89" data-line-number="89"><span class="co">// org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[51]</span></a></code></pre></div>
