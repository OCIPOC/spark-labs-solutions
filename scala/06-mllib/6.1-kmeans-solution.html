<h2 id="kmeans-solution">Kmeans solution</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">ml</span>.<span class="fu">clustering</span>.<span class="fu">KMeans</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">ml</span>.<span class="fu">feature</span>.<span class="fu">VectorAssembler</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">ml</span>.<span class="fu">linalg</span>.<span class="fu">Vectors</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">// Loads data.</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">val</span> dataset = spark.<span class="fu">read</span>.</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">              <span class="fu">option</span>(<span class="st">&quot;header&quot;</span>, <span class="st">&quot;true&quot;</span>).</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">              <span class="fu">option</span>(<span class="st">&quot;inferschema&quot;</span>, <span class="st">&quot;true&quot;</span>).</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">              <span class="fu">csv</span>(<span class="st">&quot;/data/cars/mtcars_header.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">dataset.<span class="fu">show</span>(<span class="dv">32</span>) <span class="co">// 32 data points, show all</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">// extract the columns we need</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="kw">val</span> dataset2 = dataset.<span class="fu">select</span>(<span class="st">&quot;model&quot;</span>, <span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">dataset2.<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw">val</span> assembler = <span class="kw">new</span> <span class="fu">VectorAssembler</span>().<span class="fu">setInputCols</span>(Array(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>)).<span class="fu">setOutputCol</span>(<span class="st">&quot;features&quot;</span>)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw">val</span> featureVector = assembler.<span class="fu">transform</span>(dataset2)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">featureVector.<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">// Trains a k-means model.</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">// k=2, iterations=10</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="kw">val</span> kmeans = <span class="kw">new</span> <span class="fu">KMeans</span>().<span class="fu">setK</span>(<span class="dv">2</span>).<span class="fu">setMaxIter</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="kw">val</span> model = kmeans.<span class="fu">fit</span>(featureVector)</a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">// Evaluate clustering by computing Within Set Sum of Squared Errors.</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="kw">val</span> WSSSE = model.<span class="fu">computeCost</span>(featureVector)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="fu">println</span>(s<span class="st">&quot;Within Set Sum of Squared Errors = $WSSSE&quot;</span>)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="fu">println</span>(<span class="st">&quot;Cluster Centers: &quot;</span>)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">model.<span class="fu">clusterCenters</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="co">// Print results</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="kw">val</span> predicted = model.<span class="fu">transform</span>(featureVector)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">// print sorted by &#39;prediction&#39;</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40">predicted.<span class="fu">sort</span>(<span class="st">&quot;prediction&quot;</span>).<span class="fu">show</span>(<span class="dv">32</span>,<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">predicted.<span class="fu">sort</span>(<span class="st">&quot;prediction&quot;</span>, <span class="st">&quot;mpg&quot;</span>).<span class="fu">show</span>(<span class="dv">32</span>,<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co">// lets count cars in each group</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">predicted.<span class="fu">groupBy</span>(<span class="st">&quot;prediction&quot;</span>).<span class="fu">count</span>.<span class="fu">show</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="co">// iterate over k</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="kw">for</span> (k &lt;- <span class="dv">2</span> to <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    <span class="co">//println (k)</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50">    <span class="kw">val</span> kmeans = <span class="kw">new</span> <span class="fu">KMeans</span>().<span class="fu">setK</span>(k)<span class="fu">setMaxIter</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">    <span class="kw">val</span> model = kmeans.<span class="fu">fit</span>(featureVector)</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">    <span class="kw">val</span> WSSSE = model.<span class="fu">computeCost</span>(featureVector)</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    <span class="co">//println(WSSSE)</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54">    <span class="fu">println</span>(<span class="st">&quot;%d,%f&quot;</span><span class="fu">.format</span>(k,WSSSE))</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">}</a></code></pre></div>
