<h2 id="classification-solution">Classification solution</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">// This solves the classification task using an SVM (Support Vector Machine), a linear</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">// method for binary classification.</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">SparkContext</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">mllib</span>.<span class="fu">classification</span>.<span class="fu">SVMWithSGD</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">mllib</span>.<span class="fu">evaluation</span>.<span class="fu">BinaryClassificationMetrics</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">mllib</span>.<span class="fu">regression</span>.<span class="fu">LabeledPoint</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">mllib</span>.<span class="fu">linalg</span>.<span class="fu">Vectors</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">mllib</span>.<span class="fu">util</span>.<span class="fu">MLUtils</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">rdd</span>.<span class="fu">RDD</span>;</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">// Input file:</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">//0:&quot;&quot;,1:&quot;state&quot;,2:&quot;account_length&quot;,3:&quot;area_code&quot;,4:&quot;international_plan&quot;,5:&quot;voice_mail_plan&quot;,</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">//6:&quot;number_vmail_messages&quot;,7:&quot;total_day_minutes&quot;,8:&quot;total_day_calls&quot;,9:&quot;total_day_charge&quot;,</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">//10:&quot;total_eve_minutes&quot;,11:&quot;total_eve_calls&quot;,12:&quot;total_eve_charge&quot;,13:&quot;total_night_minutes&quot;,</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">//14:&quot;total_night_calls&quot;,15:&quot;total_night_charge&quot;,16:&quot;total_intl_minutes&quot;,17:&quot;total_intl_calls&quot;,</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">//18:&quot;total_intl_charge&quot;,19:&quot;number_customer_service_calls&quot;,20:&quot;churn&quot;</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">def</span> <span class="fu">parseData</span>(vals : RDD[String]) : RDD[LabeledPoint] = {</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">  vals.<span class="fu">map</span> { s =&gt;</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    <span class="kw">val</span> parts = s.<span class="fu">split</span>(<span class="ch">&#39;,&#39;</span>).<span class="fu">drop</span>(<span class="dv">4</span>).<span class="fu">map</span>(_.<span class="fu">toDouble</span>);</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    <span class="fu">LabeledPoint</span>(<span class="kw">if</span> (<span class="fu">parts</span>(<span class="dv">16</span>)==<span class="dv">1</span>) <span class="fl">1.0</span> <span class="kw">else</span> <span class="fl">0.0</span>, Vectors.<span class="fu">dense</span>(parts))</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">// Load and parse the data</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="kw">val</span> trainingData = sc.<span class="fu">textFile</span>(<span class="st">&quot;../../../data/churn/churntrain.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="kw">val</span> splitTrainingData = <span class="fu">parseData</span>(trainingData) </a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="kw">val</span> testData = sc.<span class="fu">textFile</span>(<span class="st">&quot;../../../data/churn/churntest.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="kw">val</span> splitTestData = <span class="fu">parseData</span>(testData) </a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">// Run training algorithm to build the model</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="kw">val</span> numIterations = <span class="dv">100</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="kw">val</span> model = SVMWithSGD.<span class="fu">train</span>(splitTrainingData, numIterations)</a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">// Clear the default threshold.</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">model.<span class="fu">clearThreshold</span>()</a>
<a class="sourceLine" id="cb1-39" data-line-number="39"></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">// Compute raw scores on the test set. </span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="kw">val</span> scoreAndLabels = splitTestData.<span class="fu">map</span> { point =&gt;</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  <span class="kw">val</span> score = model.<span class="fu">predict</span>(point.<span class="fu">features</span>)</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">  (score, point.<span class="fu">label</span>)</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">}</a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="co">// Get evaluation metrics.</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="kw">val</span> metrics = <span class="kw">new</span> <span class="fu">BinaryClassificationMetrics</span>(scoreAndLabels)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="kw">val</span> auROC = metrics.<span class="fu">areaUnderROC</span>()</a>
<a class="sourceLine" id="cb1-49" data-line-number="49"></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="fu">println</span>(<span class="st">&quot;Area under ROC = &quot;</span> + auROC)</a></code></pre></div>
