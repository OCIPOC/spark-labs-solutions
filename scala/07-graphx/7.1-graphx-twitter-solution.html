<h1 id="graphx-solution-in-scala">7.1 - GraphX Solution in Scala</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">/*</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">Enter these instructions on Spark Shell... one by one.</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">So you can see what&#39;s going on.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">After you got it working, you can save the script run it as</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">    $   ~/spark/bin/spark-shell  -i  7.1-graphx-twitter-solution.scala</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">*/</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">graphx</span>._</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">rdd</span>.<span class="fu">RDD</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">val</span> vertexArray = Array(</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    (1L, (<span class="st">&quot;@markkerzner&quot;</span>, <span class="dv">309</span>, <span class="st">&quot;M&quot;</span>)),   <span class="co">// (Name, # followers, gender)</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    (2L, (<span class="st">&quot;@mjbrender&quot;</span>, <span class="dv">3101</span>, <span class="st">&quot;M&quot;</span>)),</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">    (3L, (<span class="st">&quot;@dridisahar1&quot;</span>, <span class="dv">27</span>, <span class="st">&quot;F&quot;</span>)),</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    (4L, (<span class="st">&quot;@dez_blanchfield &quot;</span>, <span class="dv">38600</span>, <span class="st">&quot;M&quot;</span>)),</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    (5L, (<span class="st">&quot;@ch_doig &quot;</span>, <span class="dv">519</span>, <span class="st">&quot;F&quot;</span>)),</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    (6L, (<span class="st">&quot;@Sunitha_Packt&quot;</span>, <span class="dv">332</span>, <span class="st">&quot;F&quot;</span>)),</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    (7L, (<span class="st">&quot;@WibiData&quot;</span>, <span class="dv">2477</span>, <span class="st">&quot;N&quot;</span>))</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb1-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">vertexArray.<span class="fu">foreach</span> { <span class="kw">case</span> (id, (name, nConnection, gender)) =&gt; <span class="fu">println</span>(s<span class="st">&quot;$name,  $nConnection, $gender&quot;</span>) }</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="kw">val</span> edgeArray = Array(</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    <span class="fu">Edge</span>(1L, 2L, <span class="dv">7</span>),  <span class="co">// src,  dest,   # retweets</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    <span class="fu">Edge</span>(1L, 3L, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    <span class="fu">Edge</span>(1L, 4L, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    <span class="fu">Edge</span>(1L, 5L, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">    <span class="fu">Edge</span>(1L, 6L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    <span class="fu">Edge</span>(1L, 7L, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="kw">val</span> vertexRDD = sc.<span class="fu">parallelize</span>(vertexArray)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">//type :  vertexRDD: RDD[(Long, (String, Int, String))]</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="kw">val</span> edgeRDD = sc.<span class="fu">parallelize</span>(edgeArray)</a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">// type : edgeRDD: RDD[Edge[Int]]</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">// construct the graph</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="kw">val</span> graph = <span class="fu">Graph</span>(vertexRDD, edgeRDD)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">// type : graph: Graph[(String, Int, String), Int]</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">graph.<span class="fu">vertices</span>.<span class="fu">foreach</span> (println)</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="co">// print all vertices (we need to collect them first!)</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">graph.<span class="fu">vertices</span>.<span class="fu">collect</span>.<span class="fu">foreach</span> { <span class="kw">case</span> (id, (name, nFollow, gender)) =&gt; <span class="fu">println</span>(s<span class="st">&quot;Tweeter $name has $nFollow followers and is $gender&quot;</span>) }</a>
<a class="sourceLine" id="cb1-47" data-line-number="47"></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="co">// print all edges</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49">graph.<span class="fu">edges</span>.<span class="fu">foreach</span> (println)</a>
<a class="sourceLine" id="cb1-50" data-line-number="50">graph.<span class="fu">edges</span>.<span class="fu">collect</span>.<span class="fu">foreach</span> { <span class="kw">case</span> (edge) =&gt; <span class="fu">println</span>(s<span class="st">&quot;$edge&quot;</span>) }</a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="co">// triplets</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54">graph.<span class="fu">triplets</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-55" data-line-number="55"></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">// filter out Males</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"><span class="kw">val</span> nonMaleFollowers = graph.<span class="fu">vertices</span>.<span class="fu">filter</span> { <span class="kw">case</span> (id, (name, followers, gender)) =&gt; gender != <span class="st">&quot;M&quot;</span> }</a>
<a class="sourceLine" id="cb1-59" data-line-number="59"></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="co">// if you want to skip @markkerzner</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="kw">val</span> nonMaleFollowers = graph.<span class="fu">vertices</span>.<span class="fu">filter</span> { <span class="kw">case</span> (id, (name, followers, gender)) =&gt; gender != <span class="st">&quot;M&quot;</span> &amp;&amp; id != <span class="dv">1</span> }</a>
<a class="sourceLine" id="cb1-62" data-line-number="62"></a>
<a class="sourceLine" id="cb1-63" data-line-number="63"><span class="co">// print</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">nonMaleFollowers.<span class="fu">collect</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-65" data-line-number="65"></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"><span class="co">// pretty print</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67">nonMaleFollowers.<span class="fu">collect</span>.</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">        foreach { <span class="kw">case</span> (id, (name, followers, gender)) =&gt;</a>
<a class="sourceLine" id="cb1-69" data-line-number="69">        <span class="fu">println</span>(s<span class="st">&quot;$name is a $gender with $followers followers&quot;</span>) }</a>
<a class="sourceLine" id="cb1-70" data-line-number="70"></a>
<a class="sourceLine" id="cb1-71" data-line-number="71"><span class="co">// find people who retweet 5 or more</span></a>
<a class="sourceLine" id="cb1-72" data-line-number="72">graph.<span class="fu">edges</span>.<span class="fu">filter</span> { <span class="kw">case</span> (edge) =&gt; edge.<span class="fu">attr</span> &gt;= <span class="dv">5</span> }.<span class="fu">collect</span></a>
<a class="sourceLine" id="cb1-73" data-line-number="73"></a>
<a class="sourceLine" id="cb1-74" data-line-number="74"><span class="co">// find people who has more than 1000 followers</span></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">graph.<span class="fu">vertices</span>.<span class="fu">filter</span> { <span class="kw">case</span> (id, (name, nFollow, gender)) =&gt; nFollow &gt;= <span class="dv">1000</span> }.<span class="fu">collect</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-76" data-line-number="76"></a>
<a class="sourceLine" id="cb1-77" data-line-number="77"><span class="co">// count male / female followers</span></a>
<a class="sourceLine" id="cb1-78" data-line-number="78"><span class="kw">val</span> maleFollowerCount = graph.<span class="fu">vertices</span>.<span class="fu">filter</span> { <span class="kw">case</span> (id, (name, nFollow, gender)) =&gt; gender == <span class="st">&quot;M&quot;</span> }.<span class="fu">count</span></a>
<a class="sourceLine" id="cb1-79" data-line-number="79"><span class="kw">val</span> femaleFollowerCount = graph.<span class="fu">vertices</span>.<span class="fu">filter</span> { <span class="kw">case</span> (id, (name, nFollow, gender)) =&gt; gender == <span class="st">&quot;F&quot;</span> }.<span class="fu">count</span></a>
<a class="sourceLine" id="cb1-80" data-line-number="80"></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"><span class="fu">println</span> (s<span class="st">&quot;$maleFollowerCount male followers &amp; $femaleFollowerCount female followers &quot;</span>)</a>
<a class="sourceLine" id="cb1-82" data-line-number="82"></a>
<a class="sourceLine" id="cb1-83" data-line-number="83">exit <span class="co">// exit shell</span></a></code></pre></div>
