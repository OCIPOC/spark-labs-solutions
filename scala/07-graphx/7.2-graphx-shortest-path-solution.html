<h1 id="graphx-solution---scala">7.2 GraphX Solution - Scala</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">// run it as :   spark-shell -i   7.2-graphx-shortest-path-solution.scala</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">graphx</span>._</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">rdd</span>.<span class="fu">RDD</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">import</span> org.<span class="fu">apache</span>.<span class="fu">spark</span>.<span class="fu">graphx</span>.<span class="fu">util</span>.<span class="fu">GraphGenerators</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">val</span> vertexArray = Array(</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="co">// direct connections</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">        (1L, (<span class="st">&quot;Mark Kerzner&quot;</span>, <span class="dv">2757</span>)),</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">        (2L, (<span class="st">&quot;Sujee Maniyam&quot;</span>, <span class="dv">891</span>)),</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">        (3L, (<span class="st">&quot;Yaakov Weintraub&quot;</span>, <span class="dv">105</span>)),</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        (4L, (<span class="st">&quot;Packt Publishing&quot;</span>, <span class="dv">2984</span>)),</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        (5L, (<span class="st">&quot;Barry Kaufman &quot;</span>, <span class="dv">500</span>)),</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        (6L, (<span class="st">&quot;Tony Piazza&quot;</span>, <span class="dv">500</span>)),</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        (7L, (<span class="st">&quot;Tim Fox&quot;</span>, <span class="dv">500</span>)),</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">        (8L, (<span class="st">&quot;Vamsi Sistla&quot;</span>, <span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">        )</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">val</span> edgeArray = Array(</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    <span class="fu">Edge</span>(1L, 2L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    <span class="fu">Edge</span>(1L, 3L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    <span class="fu">Edge</span>(1L, 4L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    <span class="fu">Edge</span>(1L, 5L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    <span class="fu">Edge</span>(2L, 6L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="fu">Edge</span>(6L, 7L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    <span class="fu">Edge</span>(7L, 8L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    <span class="fu">Edge</span>(3L, 7L, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    <span class="fu">Edge</span>(3L, 8L, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="kw">val</span> vertexRDD: RDD[(Long, (String, Int))] = sc.<span class="fu">parallelize</span>(vertexArray)</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="kw">val</span> edgeRDD: RDD[Edge[Int]] = sc.<span class="fu">parallelize</span>(edgeArray)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="kw">val</span> graph: Graph[(String, Int), Int] = <span class="fu">Graph</span>(vertexRDD, edgeRDD)</a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">// printl</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">graph.<span class="fu">vertices</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">graph.<span class="fu">edges</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">graph.<span class="fu">triplets</span>.<span class="fu">foreach</span>(println)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41"></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="co">//graph.vertices.collect.foreach { case (id, (name, nConnection)) =&gt; println(s&quot;Linkedin $name with $nConnection&quot;) }</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="co">// find connections from &#39;Mark Kerzner&#39; ( ID = 1)</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="kw">val</span> sourceId: VertexId = <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="kw">val</span> initialGraph = graph.<span class="fu">mapVertices</span>((id, _) =&gt; <span class="kw">if</span> (id == sourceId) <span class="fl">0.0</span> <span class="kw">else</span> Double.<span class="fu">PositiveInfinity</span>)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="co">// print out the initial graph</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50">initialGraph.<span class="fu">vertices</span>.<span class="fu">collect</span>.<span class="fu">foreach</span> { <span class="kw">case</span> (id) =&gt; <span class="fu">println</span>(s<span class="st">&quot;VertexId: $id&quot;</span>) }</a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="kw">val</span> sssp = initialGraph.<span class="fu">pregel</span>(Double.<span class="fu">PositiveInfinity</span>)(</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    (id, dist, newDist) =&gt; math.<span class="fu">min</span>(dist, newDist), <span class="co">// Vertex Program</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54">        triplet =&gt; {  <span class="co">// Send Message</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55">        <span class="kw">if</span> (triplet.<span class="fu">srcAttr</span> + triplet.<span class="fu">attr</span> &lt; triplet.<span class="fu">dstAttr</span>) {</a>
<a class="sourceLine" id="cb1-56" data-line-number="56">            Iterator((triplet.<span class="fu">dstId</span>, triplet.<span class="fu">srcAttr</span> + triplet.<span class="fu">attr</span>))</a>
<a class="sourceLine" id="cb1-57" data-line-number="57">        } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb1-58" data-line-number="58">            Iterator.<span class="fu">empty</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59">        }</a>
<a class="sourceLine" id="cb1-60" data-line-number="60">    },</a>
<a class="sourceLine" id="cb1-61" data-line-number="61">    (a,b) =&gt; math.<span class="fu">min</span>(a,b) <span class="co">// Merge Message</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62">)</a>
<a class="sourceLine" id="cb1-63" data-line-number="63"></a>
<a class="sourceLine" id="cb1-64" data-line-number="64"><span class="fu">println</span>(sssp.<span class="fu">vertices</span>.<span class="fu">collect</span>.<span class="fu">mkString</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb1-65" data-line-number="65"></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"><span class="co">// pretty print</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67">sssp.<span class="fu">vertices</span>.<span class="fu">collect</span>.<span class="fu">foreach</span> { <span class="kw">case</span> (id, distance) =&gt; <span class="fu">println</span>(s<span class="st">&quot;Shortest distance from Mark --&gt; $id  = $distance&quot;</span>) }</a>
<a class="sourceLine" id="cb1-68" data-line-number="68"></a>
<a class="sourceLine" id="cb1-69" data-line-number="69">exit <span class="co">// exit shell</span></a></code></pre></div>
